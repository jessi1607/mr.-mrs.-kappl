<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lena & Franz - 27.09.2025</title>
<style>
  body {
    background: white;
    font-family: 'Georgia', serif;
    color: #2a4d2a; /* dunkles grün */
    margin: 0; padding: 20px;
    display: flex; flex-direction: column; align-items: center;
  }
  h1 {
    color: #a17c00; /* gold */
    font-size: 2.5rem;
    margin-bottom: 0;
  }
  p.subtitle {
    font-style: italic;
    color: #4a704a;
    margin-top: 0;
    margin-bottom: 30px;
  }
  video {
    border: 4px solid #a17c00;
    border-radius: 10px;
    max-width: 100vw;
    height: auto;
  }
  canvas {
    display: none;
  }
  #photo {
    margin-top: 20px;
    max-width: 100vw;
    border: 4px solid #2a4d2a;
    border-radius: 10px;
  }
  button {
    background-color: #2a4d2a;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 10px 18px;
    margin: 10px 5px;
    font-size: 1rem;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(161, 124, 0, 0.6);
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #8c6700;
  }
  #message {
    margin-top: 15px;
    font-weight: bold;
    color: #a17c00;
  }
</style>
</head>
<body>
  <h1>Lena & Franz - 27.09.2025</h1>
  <p class="subtitle">Gemeinsam Hand in Hand ein lebenlang</p>

  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>

  <div>
    <button id="frontBtn">Frontkamera</button>
    <button id="backBtn">Rückkamera</button>
  </div>

  <button id="takePhotoBtn">Foto machen</button>
  <button id="uploadBtn" disabled>Hochladen</button>

  <img id="photo" alt="Aufgenommenes Foto" />

  <div id="message"></div>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const photo = document.getElementById('photo');
  const message = document.getElementById('message');

  let currentStream = null;
  let currentFacingMode = 'user'; // 'user' = front, 'environment' = back
  let capturedImageBlob = null;

  async function startCamera(facingMode) {
    if (currentStream) {
      currentStream.getTracks().forEach(track => track.stop());
    }
    try {
      currentStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { exact: facingMode } },
        audio: false
      });
      video.srcObject = currentStream;
      currentFacingMode = facingMode;
      message.textContent = '';
      document.getElementById('uploadBtn').disabled = true;
      photo.src = '';
      capturedImageBlob = null;
    } catch (err) {
      // Fallback: ohne exact (bei manchen Browsern besser)
      try {
        currentStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: facingMode },
          audio: false
        });
        video.srcObject = currentStream;
        currentFacingMode = facingMode;
        message.textContent = '';
        document.getElementById('uploadBtn').disabled = true;
        photo.src = '';
        capturedImageBlob = null;
      } catch (error) {
        console.error('Kamera konnte nicht gestartet werden:', error);
        message.textContent = 'Kamera konnte nicht gestartet werden. Bitte überprüfe die Berechtigungen.';
      }
    }
  }

  document.getElementById('frontBtn').addEventListener('click', () => startCamera('user'));
  document.getElementById('backBtn').addEventListener('click', () => startCamera('environment'));

  document.getElementById('takePhotoBtn').addEventListener('click', () => {
    if (!currentStream) {
      message.textContent = 'Bitte erst Kamera auswählen.';
      return;
    }
    const width = video.videoWidth;
    const height = video.videoHeight;
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, width, height);
    canvas.toBlob(blob => {
      capturedImageBlob = blob;
      photo.src = URL.createObjectURL(blob);
      document.getElementById('uploadBtn').disabled = false;
      message.textContent = 'Foto aufgenommen. Jetzt Hochladen klicken.';
    }, 'image/jpeg', 0.95);
  });

  document.getElementById('uploadBtn').addEventListener('click', async () => {
    if (!capturedImageBlob) {
      message.textContent = 'Bitte erst ein Foto machen.';
      return;
    }

    message.textContent = 'Lade Bild hoch...';

    // Dropbox Access Token (bitte mit deinem eigenen Token ersetzen)
    const DROPBOX_ACCESS_TOKEN = 'sl.u.AF09KUWmSCXi7yIlar4UloHwPPVY0PijSB4f49OQzr6tOSIrIY5yL0-mrZtsmDdw8IJhE-AdP05fu_KF74kcr0oy5gYftA93PbIZDr9edKHl1RmhJHAtuL4wrMIH0vmEdWFVe_MFjLAo5hs2tJlyOGBtbqXdSdF5dGA0EESL8f6DU6NSXmFpUqsGoUxhL9Cpfizr-qiKAvo6mPe2mi3h54R4Mp_hreaw_pV1jw8f6tFIZffZeubPr0eKwP_NTEyEX-iXMcMtq4Br4o3Iddv-YA6yLm-n_cWF9s6Jyz0TRuHSffiT6ynPIAe3IK4So464yKAgJz8D1fn3nh96t5x5V9TkD2hvjECiW3D7P8WQqrNBOAQi06OywG0ffn0128vSHzHrEgUyywXt7gZ_J29TAFK5s95JPSdDh75yGDIHm8ncqQ1DoJ27EunY-jQZGHdjjIhErSN8aH-ED6vlSfKxeu72uvAZ2ZaXf3uKMMYdKDBAvrRPCYRzjLNMyVz9WKeOszlpJz-tI-CqAkcnAMmHtwZog52L2Qd3SPeNnoboYyX530_c38bwxRhpJbNZYZP8uNgOUQfqo3nKlai3k5O6Hg3DXI7OVtAeGpBmJGf-ohxtN-ozK6uyc_HNZm9c82e-llDOEBfXHQZhSYgjDcyqH0Mq5YiMXvPMPhiLK5cycYw175SZuvMj5acjPDHIebQTgfmJu0M4n45LKYfOFfe_pCfF7u8NtscIX-J5w3NkPlMuXs35coGjy-Yr3L6b5TdDTUFb0vIDRxt_SML-svPrD3Ln0JdeASSoD3cIHh_PYxFIazy6G_9_uCzkoIIkVN4837WcNVtf7MIMr0itTH31KKCuI6wYYYfO3oGI8gq2lkgonhoC3bVeRAr-RDDn5fic4r5M5Ytto6VRcWYILmallfdUSFZzbEbSWihxBI61V3jciiTyoiuKRUE4wELJsseQ3BOWiKM_6tQkt4s_STWQW8sTquDPE7LJsYGV9dgxqvf-SWG8sadrrFZQ4XIyhlMz0GtxF6m6qy08Sth3jNGHcOQfPpoB2YGfCAb7dhkz6An4ecq8hBgFWjMB2gT0vU1hNz_pz4_S09IXc59UhaBytB1EmGnOTZSoXeq3a69Ni_jO8aECZXPG0Ng5KkwRfI1F1uXUpCQl5Bdy6w6fteBq4I7H1G5O1XiGub0jG3U8tBgfbvFspteWjP7CVgInaYc9Hb_GnladtB31T9TIuzXiczb3UEnZ8jgECbw2OBOb1jTHDtl34p9G5LFTs1b1aI0tBeTwjo2QQgJPHkybyMicb541sECi0szfLzRNGiNwkIZnCQ';

    // Erstelle FormData für Upload
    const filename = `LenaFranz_${Date.now()}.jpg`;

    try {
      const response = await fetch('https://content.dropboxapi.com/2/files/upload', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${DROPBOX_ACCESS_TOKEN}`,
          'Dropbox-API-Arg': JSON.stringify({
            path: '/' + filename,
            mode: 'add',
            autorename: true,
            mute: false,
          }),
          'Content-Type': 'application/octet-stream',
        },
        body: capturedImageBlob
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error_summary || 'Unbekannter Fehler');
      }

      message.textContent = 'Bild erfolgreich hochgeladen. Danke!';

      // Bild nach Upload zurücksetzen
      photo.src = '';
      capturedImageBlob = null;
      document.getElementById('uploadBtn').disabled = true;

    } catch (error) {
      console.error('Upload-Fehler:', error);
      message.textContent = 'Fehler beim Hochladen: ' + error.message;
    }
  });

  // Starte standardmäßig mit Frontkamera
  startCamera('user');
</script>
</body>
</html>
